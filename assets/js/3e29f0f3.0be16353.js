"use strict";(globalThis.webpackChunkhumanoid_robotics_book=globalThis.webpackChunkhumanoid_robotics_book||[]).push([[95],{2845(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(8168),a=(n(6540),n(5680));const i={id:"tf2",title:"Module 1: Coordinate Frames with tf2",sidebar_label:"tf2"},o=void 0,s={unversionedId:"ros2/tf2",id:"ros2/tf2",title:"Module 1: Coordinate Frames with tf2",description:"Handling Coordinate Frames with tf2",source:"@site/docs/ros2/tf2.md",sourceDirName:"ros2",slug:"/ros2/tf2",permalink:"/docs/ros2/tf2",draft:!1,tags:[],version:"current",frontMatter:{id:"tf2",title:"Module 1: Coordinate Frames with tf2",sidebar_label:"tf2"},sidebar:"tutorialSidebar",previous:{title:"Week 5: Transforms & URDFs",permalink:"/docs/ros2/week5"},next:{title:"URDF",permalink:"/docs/ros2/urdf"}},l={},p=[{value:"Handling Coordinate Frames with tf2",id:"handling-coordinate-frames-with-tf2",level:2},{value:"Key Concepts of tf2",id:"key-concepts-of-tf2",level:3},{value:"Example: A Static Transform Publisher",id:"example-a-static-transform-publisher",level:3},{value:"Visualizing with RViz2",id:"visualizing-with-rviz2",level:3}],f={toc:p};function m({components:e,...t}){return(0,a.yg)("wrapper",(0,r.A)({},f,t,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"handling-coordinate-frames-with-tf2"},"Handling Coordinate Frames with tf2"),(0,a.yg)("p",null,"In any robot with moving parts or multiple sensors, you need a way to keep track of how all the different coordinate frames relate to each other. In ROS 2, this is handled by the ",(0,a.yg)("inlineCode",{parentName:"p"},"tf2")," library. ",(0,a.yg)("inlineCode",{parentName:"p"},"tf2"),' allows you to ask questions like, "What is the position of the robot\'s hand relative to its base?" or "What is the pose of the object detected by the camera in the map frame?"'),(0,a.yg)("h3",{id:"key-concepts-of-tf2"},"Key Concepts of tf2"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Transform (tf):")," A transform represents the relationship between two coordinate frames. It includes both a translation (a 3D vector) and a rotation (a quaternion)."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"tf2 Buffer:")," A buffer stores transforms received from the ",(0,a.yg)("inlineCode",{parentName:"li"},"/tf")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"/tf_static")," topics."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"tf2 Listener:")," A listener subscribes to the transform topics and populates a ",(0,a.yg)("inlineCode",{parentName:"li"},"tf2")," buffer."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"tf2 Broadcaster:")," A broadcaster publishes transforms to the ",(0,a.yg)("inlineCode",{parentName:"li"},"/tf")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"/tf_static")," topics.")),(0,a.yg)("h3",{id:"example-a-static-transform-publisher"},"Example: A Static Transform Publisher"),(0,a.yg)("p",null,'Often, some parts of a robot are fixed relative to others. For example, a camera might be mounted at a specific position on the robot\'s chassis. You can publish this relationship as a "static transform."'),(0,a.yg)("p",null,"Here is how you can publish a static transform using a Python script. This script publishes a transform between a ",(0,a.yg)("inlineCode",{parentName:"p"},"base_link")," frame and a ",(0,a.yg)("inlineCode",{parentName:"p"},"camera_link")," frame."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"# static_tf_pub.py\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros.static_transform_broadcaster import StaticTransformBroadcaster\nimport tf_transformations\n\nclass StaticFramePublisher(Node):\n    \"\"\"\n    Broadcasts a static transform.\n    \"\"\"\n    def __init__(self):\n        super().__init__('static_transform_publisher')\n        self._broadcaster = StaticTransformBroadcaster(self)\n\n        # Publish a static transform once at startup\n        self.make_transforms()\n\n    def make_transforms(self):\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'camera_link'\n\n        # The camera is positioned 1 meter forward, 0.5 meters up\n        t.transform.translation.x = 1.0\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.5\n\n        # No rotation for this example\n        q = tf_transformations.quaternion_from_euler(0, 0, 0)\n        t.transform.rotation.x = q[0]\n        t.transform.rotation.y = q[1]\n        t.transform.rotation.z = q[2]\n        t.transform.rotation.w = q[3]\n\n        self.get_logger().info(f\"Publishing static transform from '{t.header.frame_id}' to '{t.child_frame_id}'\")\n        self._broadcaster.sendTransform(t)\n\ndef main():\n    rclpy.init()\n    node = StaticFramePublisher()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n")),(0,a.yg)("p",null,"To run this, you will need the ",(0,a.yg)("inlineCode",{parentName:"p"},"tf_transformations")," library. You can install it with ",(0,a.yg)("inlineCode",{parentName:"p"},"pip install tf-transformations"),"."),(0,a.yg)("h3",{id:"visualizing-with-rviz2"},"Visualizing with RViz2"),(0,a.yg)("p",null,"The best way to understand ",(0,a.yg)("inlineCode",{parentName:"p"},"tf2")," is to visualize it."),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Run the ",(0,a.yg)("inlineCode",{parentName:"li"},"static_tf_pub.py")," node."),(0,a.yg)("li",{parentName:"ol"},"Open RViz2 by running ",(0,a.yg)("inlineCode",{parentName:"li"},"rviz2")," in a new terminal."),(0,a.yg)("li",{parentName:"ol"},'In the "Displays" panel, click "Add" and select "TF".'),(0,a.yg)("li",{parentName:"ol"},"You should now see the ",(0,a.yg)("inlineCode",{parentName:"li"},"base_link")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"camera_link")," frames visualized, showing their relative positions and orientations.")),(0,a.yg)("p",null,"This provides a powerful way to debug and understand the spatial relationships within your robot system. We will use ",(0,a.yg)("inlineCode",{parentName:"p"},"tf2")," extensively when we work with robot models and navigation."))}m.isMDXComponent=!0},5680(e,t,n){n.d(t,{xA:()=>f,yg:()=>d});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},f=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef(function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,f=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=a,u=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return n?r.createElement(u,o(o({ref:t},f),{},{components:n})):r.createElement(u,o({ref:t},f))});function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);
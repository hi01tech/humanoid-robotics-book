"use strict";(globalThis.webpackChunkhumanoid_robotics_book=globalThis.webpackChunkhumanoid_robotics_book||[]).push([[813],{159(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var i=t(8168),a=(t(6540),t(5680));const o={id:"week7",title:"Module 2: Interacting with the Digital Twin",sidebar_label:"Week 7: ROS 2 Interaction"},r=void 0,s={unversionedId:"digital-twin/week7",id:"digital-twin/week7",title:"Module 2: Interacting with the Digital Twin",description:"Week 7: Interacting with the Digital Twin via ROS 2",source:"@site/docs/digital-twin/week7.md",sourceDirName:"digital-twin",slug:"/digital-twin/week7",permalink:"/humanoid-robotics-book/docs/digital-twin/week7",draft:!1,tags:[],version:"current",frontMatter:{id:"week7",title:"Module 2: Interacting with the Digital Twin",sidebar_label:"Week 7: ROS 2 Interaction"},sidebar:"tutorialSidebar",previous:{title:"Week 6: Digital Twin Concepts",permalink:"/humanoid-robotics-book/docs/digital-twin/week6"},next:{title:"ros2_control",permalink:"/humanoid-robotics-book/docs/digital-twin/ros2-control"}},l={},c=[{value:"Week 7: Interacting with the Digital Twin via ROS 2",id:"week-7-interacting-with-the-digital-twin-via-ros-2",level:2},{value:"The ROS 2 Bridge in Isaac Sim",id:"the-ros-2-bridge-in-isaac-sim",level:3},{value:"Example: Reading Sensor Data from the Digital Twin",id:"example-reading-sensor-data-from-the-digital-twin",level:3},{value:"In Isaac Sim:",id:"in-isaac-sim",level:4},{value:"In ROS 2 (Python Node):",id:"in-ros-2-python-node",level:4},{value:"Example: Sending Commands to the Digital Twin",id:"example-sending-commands-to-the-digital-twin",level:3},{value:"In Isaac Sim:",id:"in-isaac-sim-1",level:4},{value:"In ROS 2 (Python Node):",id:"in-ros-2-python-node-1",level:4}],m={toc:c};function d({components:e,...n}){return(0,a.yg)("wrapper",(0,i.A)({},m,n,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"week-7-interacting-with-the-digital-twin-via-ros-2"},"Week 7: Interacting with the Digital Twin via ROS 2"),(0,a.yg)("p",null,"Last week, we introduced the concept of a digital twin. This week, we'll dive into the practical aspects of communicating with our digital twin in Isaac Sim using ROS 2. Isaac Sim comes with a powerful set of ROS 2 bridge extensions that make this communication seamless."),(0,a.yg)("h3",{id:"the-ros-2-bridge-in-isaac-sim"},"The ROS 2 Bridge in Isaac Sim"),(0,a.yg)("p",null,'The "ROS 2 Bridge" is an extension within Isaac Sim that connects the simulation environment to the ROS 2 network. It can:'),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Publish simulation data to ROS 2 topics:")," This includes sensor data (like camera images, LiDAR scans, and IMU readings), the state of the robot (joint states), and simulation clock."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Subscribe to ROS 2 topics to control the simulation:")," This allows us to send commands from our ROS 2 nodes to control robot joints, apply forces, and change the environment.")),(0,a.yg)("p",null,"This means that from the perspective of our ROS 2 code, there is no difference between interacting with the simulated robot and a physical one. We just publish and subscribe to the same topics."),(0,a.yg)("h3",{id:"example-reading-sensor-data-from-the-digital-twin"},"Example: Reading Sensor Data from the Digital Twin"),(0,a.yg)("p",null,"Let's imagine our digital twin has a camera attached to it. We can configure Isaac Sim to publish the images from this camera to a ROS 2 topic."),(0,a.yg)("h4",{id:"in-isaac-sim"},"In Isaac Sim:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Add a camera to the robot model in the Isaac Sim scene."),(0,a.yg)("li",{parentName:"ol"},'Add the "ROS 2 Camera Helper" graph node to the camera\'s action graph.'),(0,a.yg)("li",{parentName:"ol"},"Configure the node to publish the camera data to a topic, for example, ",(0,a.yg)("inlineCode",{parentName:"li"},"/robot/camera/image_raw"),".")),(0,a.yg)("h4",{id:"in-ros-2-python-node"},"In ROS 2 (Python Node):"),(0,a.yg)("p",null,"We can then write a simple subscriber node to receive and process these images. This example uses ",(0,a.yg)("inlineCode",{parentName:"p"},"cv_bridge")," to convert the ROS 2 image message to an OpenCV image, which is a common practice."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"# image_subscriber.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image\nfrom cv_bridge import CvBridge\nimport cv2\n\nclass ImageSubscriber(Node):\n    def __init__(self):\n        super().__init__('image_subscriber')\n        self.subscription = self.create_subscription(\n            Image,\n            '/robot/camera/image_raw',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n        self.bridge = CvBridge()\n        self.get_logger().info(\"Image subscriber node started and subscribing to '/robot/camera/image_raw'\")\n\n    def listener_callback(self, data):\n        self.get_logger().info('Receiving video frame')\n        # Convert ROS Image message to OpenCV image\n        current_frame = self.bridge.imgmsg_to_cv2(data)\n        \n        # In a real application, you would perform image processing here.\n        # For this example, we'll just display the image.\n        cv2.imshow(\"Camera Feed\", current_frame)\n        cv2.waitKey(1)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    image_subscriber = ImageSubscriber()\n    rclpy.spin(image_subscriber)\n    image_subscriber.destroy_node()\n    rclpy.shutdown()\n    cv2.destroyAllWindows()\n\nif __name__ == '__main__':\n    main()\n")),(0,a.yg)("p",null,"To run this, you'll need ",(0,a.yg)("inlineCode",{parentName:"p"},"opencv-python")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"cv_bridge"),". You can typically install OpenCV with ",(0,a.yg)("inlineCode",{parentName:"p"},"pip install opencv-python"),". ",(0,a.yg)("inlineCode",{parentName:"p"},"cv_bridge")," is a standard ROS package."),(0,a.yg)("h3",{id:"example-sending-commands-to-the-digital-twin"},"Example: Sending Commands to the Digital Twin"),(0,a.yg)("p",null,"The communication flows both ways. We can also send commands to our digital twin. A common task is to control the joints of a robot arm."),(0,a.yg)("h4",{id:"in-isaac-sim-1"},"In Isaac Sim:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Ensure your robot's joints are correctly configured."),(0,a.yg)("li",{parentName:"ol"},'Add a "ROS 2 Joint State" subscriber node to the action graph. This node will listen for ',(0,a.yg)("inlineCode",{parentName:"li"},"sensor_msgs/msg/JointState")," messages."),(0,a.yg)("li",{parentName:"ol"},"This node will drive the robot's joints based on the positions received in the messages.")),(0,a.yg)("h4",{id:"in-ros-2-python-node-1"},"In ROS 2 (Python Node):"),(0,a.yg)("p",null,'We can write a publisher node that sends joint commands. This example sends a command to move a "shoulder_joint" to a specific position.'),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-python"},"# joint_commander.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\n\nclass JointCommander(Node):\n    def __init__(self):\n        super().__init__('joint_commander')\n        self.publisher_ = self.create_publisher(JointState, '/joint_command', 10)\n        self.timer = self.create_timer(1.0, self.timer_callback)\n        self.target_position = 0.785  # 45 degrees in radians\n\n    def timer_callback(self):\n        msg = JointState()\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.name = ['shoulder_joint']\n        msg.position = [self.target_position]\n        \n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing joint command for shoulder_joint: {self.target_position}')\n        \n        # Toggle position for demonstration\n        if self.target_position > 0:\n            self.target_position = -0.785\n        else:\n            self.target_position = 0.785\n\ndef main(args=None):\n    rclpy.init(args=args)\n    joint_commander = JointCommander()\n    rclpy.spin(joint_commander)\n    joint_commander.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n")),(0,a.yg)("p",null,"When this node is running, the ",(0,a.yg)("inlineCode",{parentName:"p"},"shoulder_joint")," of the robot in Isaac Sim will move back and forth between 45 and -45 degrees. This demonstrates direct control of the digital twin from our external ROS 2 code."))}d.isMDXComponent=!0},5680(e,n,t){t.d(n,{xA:()=>m,yg:()=>p});var i=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=i.createContext({}),c=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},m=function(e){var n=c(e.components);return i.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},g=i.forwardRef(function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),g=c(t),p=a,u=g["".concat(l,".").concat(p)]||g[p]||d[p]||o;return t?i.createElement(u,r(r({ref:n},m),{},{components:t})):i.createElement(u,r({ref:n},m))});function p(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=g;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var c=2;c<o;c++)r[c]=t[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}g.displayName="MDXCreateElement"}}]);